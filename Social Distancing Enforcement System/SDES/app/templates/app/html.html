<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Display Webcam Stream</title>

    <style>
      #videoElement {
      	width: 500px;
      	height: 375px;
      	background-color: #666;
      }
    </style>
  </head>

  <body>
    <img src="/webcam_feed" class="mt-5 mx-auto d-block" height="720px" width="1080px" title="Source">
    <div id="container">
    	<video autoplay="true" id="videoElement" allow="geoloaction" hidden></video>
      <canvas id="canvasOutput" hidden></canvas>

      <div class="form-group">
        <button id="button" class="form-control" type="button" value="POST">Start</button>
      </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <script>
      "use strict"
      const video = document.getElementById('videoElement');
      const canvas = document.getElementById('canvasOutput');
      const context = canvas.getContext("2d");
      const button = document.getElementById('button');
      const constrains = {audio : false, video: { width: { max: 1080 }, height: { max: 720 }}};
      button.onclick = function() {click()};
      function post() {
        if (button.innerText == "Stop"){
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          $.post('/io/',{
            label : "video capture",
            content : canvas.toDataURL("image/png")
          },
          function(data, status){
            return true
          });
          setTimeout(() =>{post();}, 100);
        } else{
          return true
        }
      };

      function click(){
        if (button.value == "POST") {
          button.value = "SEND";
          button.innerText = "Stop";
          return post();
        } else {
          button.innerText = "Start";
          button.value = "POST";
        }
      };
      // click()
      navigator.mediaDevices.getUserMedia(constrains)
      .then(function(mediaStream) {
        video.srcObject = mediaStream;
      });

    </script>
  </body>
</html>
